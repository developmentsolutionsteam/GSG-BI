WITH ARTICULOS AS (
SELECT
a.ORGANIZATION_CODE
,b.NAME ORGANIZATION
,inv.ITEM_NUMBER ITEM
,inv.DESCRIPTION DESCRIPTION_ITEM
--,inv.PRIMARY_UOM_CODE UOM_CODE
,UOMT.UNIT_OF_MEASURE
,inv.organization_id
,inv.INVENTORY_ITEM_ID
--,d.SUBINVENTORY_CODE SUBINVENTARIO
--,ECT.*
,inv.MIN_MINMAX_QUANTITY MINIMO
,inv.MAX_MINMAX_QUANTITY MAXIMO


FROM EGP_SYSTEM_ITEMS inv
--EGP_SYSTEM_ITEMS_B org
,INV_UNITS_OF_MEASURE_TL UOMT
,INV_UNITS_OF_MEASURE_B UOMB
,INV_ORG_PARAMETERS a
,HR_ORGANIZATION_UNITS_F_TL b
--,INV_MATERIAL_TXNS d
--,egp_item_categories c
--,EGP_CATEGORIES_TL ECT
--,EGP_CATEGORIES_B d

WHERE 1 = 1
--org.inventory_item_id = inv.inventory_item_id -- v1.0.1 DO 07022022
AND b.organization_id = inv.organization_id -- v1.0.1 DO 07022022
AND a.organization_id = inv.organization_id -- v1.0.1 DO 07022022
--UNIDAD
and UOMB.UOM_CODE = inv.PRIMARY_UOM_CODE
and UOMT.UNIT_OF_MEASURE_ID = UOMB.UNIT_OF_MEASURE_ID
AND UOMT.LANGUAGE = 'US'
--SUBINVENTARIO
--AND d.INVENTORY_ITEM_ID = inv.INVENTORY_ITEM_ID 
--AND d.organization_id = inv.organization_id
--AND d.LOCATOR_ID = inv.INVENTORY_LOCATION_ID (+)
--CATEGORIA
/*
AND c.organization_id = inv.organization_id -- v1.0.1 DO 07022022
AND c.INVENTORY_ITEM_ID = inv.INVENTORY_ITEM_ID -- v1.0.1 DO 07022022
AND ECT.CATEGORY_ID = c.CATEGORY_ID
AND ECT.LANGUAGE='US'
*/
--AND d.CATEGORY_ID = c.CATEGORY_ID
AND inv.ITEM_NUMBER='3503000027'
AND b.LANGUAGE='US'
),
CATEGORIA AS (
 SELECT art.organization_id, art.INVENTORY_ITEM_ID,c.CATEGORY_ID, ECT.CATEGORY_NAME, ECSB.CATALOG_CODE FROM 
 ARTICULOS art  
 ,egp_item_categories c 
 ,EGP_CATEGORIES_TL ECT
,EGP_CATEGORY_SETS_B ECSB
WHERE 1 = 1
AND art.organization_id = c.organization_id (+)
AND art.INVENTORY_ITEM_ID = c.INVENTORY_ITEM_ID (+)
AND ECT.CATEGORY_ID = c.CATEGORY_ID
AND ECT.LANGUAGE='US'
and c.CATEGORY_SET_ID = ECSB.CATEGORY_SET_ID(+)
GROUP BY art.organization_id, art.INVENTORY_ITEM_ID,c.CATEGORY_ID, ECT.CATEGORY_NAME, ECSB.CATALOG_CODE
),
CANTIDAD AS (
SELECT q.INVENTORY_ITEM_ID,q.ORGANIZATION_ID,loc.SEGMENT1,q.SUBINVENTORY_CODE,Round(sum(q.PRIMARY_TRANSACTION_QUANTITY),3) CANTIDAD 
FROM INV_ONHAND_QUANTITIES_DETAIL q
,ARTICULOS art  
,INV_ITEM_LOCATIONS loc
WHERE 1=1
AND art.organization_id = q.organization_id (+)
AND art.INVENTORY_ITEM_ID = q.INVENTORY_ITEM_ID (+)
AND q.LOCATOR_ID = loc.INVENTORY_LOCATION_ID(+)
AND q.organization_id = loc.organization_id (+)
--AND INVENTORY_ITEM_ID = '100000002954640'
--AND organization_id = '300000003087000' 
GROUP BY q.INVENTORY_ITEM_ID,q.ORGANIZATION_ID,loc.SEGMENT1,q.SUBINVENTORY_CODE
)
--SELECT * FROM CATEGORIA
SELECT ART.*
, CAT1.CATEGORY_NAME AS CAT_COMPRAS
, CAT2.CATEGORY_NAME AS CAT_INVENTARIOS
, CAT3.CATEGORY_NAME AS CAT_COSTOS
,CA.SUBINVENTORY_CODE
,CA.CANTIDAD
,CA.SEGMENT1
FROM ARTICULOS ART
,CATEGORIA CAT1
,CATEGORIA CAT2
,CATEGORIA CAT3
,CANTIDAD CA
WHERE 1 = 1
AND ART.ORGANIZATION_ID = CAT1.ORGANIZATION_ID (+)
AND CAT1.CATALOG_CODE = 'CAT_COMPRAS'
AND ART.ORGANIZATION_ID = CAT2.ORGANIZATION_ID (+)
AND CAT2.CATALOG_CODE = 'CAT_INVENTARIOS'
AND ART.ORGANIZATION_ID = CAT3.ORGANIZATION_ID (+)
AND CAT3.CATALOG_CODE = 'CAT_COSTOS'
AND ART.ORGANIZATION_ID = CA.ORGANIZATION_ID (+)
AND ART.INVENTORY_ITEM_ID = CA.INVENTORY_ITEM_ID (+)
