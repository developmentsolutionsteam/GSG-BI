WITH ARTICULOS AS (
SELECT
a.ORGANIZATION_CODE
,b.NAME ORGANIZATION
,inv.ITEM_NUMBER ITEM
,inv.DESCRIPTION DESCRIPTION_ITEM
--,inv.PRIMARY_UOM_CODE UOM_CODE
,UOMT.UNIT_OF_MEASURE
,inv.organization_id
,inv.INVENTORY_ITEM_ID
--,d.SUBINVENTORY_CODE SUBINVENTARIO
--,ECT.*
,inv.MIN_MINMAX_QUANTITY MINIMO
,inv.MAX_MINMAX_QUANTITY MAXIMO
,inv.LIST_PRICE_PER_UNIT
,lot.LOT_NUMBER
,ser.SERIAL_NUMBER
FROM EGP_SYSTEM_ITEMS inv
--EGP_SYSTEM_ITEMS_B org
,INV_UNITS_OF_MEASURE_TL UOMT
,INV_UNITS_OF_MEASURE_B UOMB
,INV_ORG_PARAMETERS a
,HR_ORGANIZATION_UNITS_F_TL b
--,INV_MATERIAL_TXNS d
--,egp_item_categories c
--,EGP_CATEGORIES_TL ECT
--,EGP_CATEGORIES_B d
,inv_lot_numbers lot
,INV_SERIAL_NUMBERS ser

WHERE 1 = 1
--org.inventory_item_id = inv.inventory_item_id -- v1.0.1 DO 07022022
AND b.organization_id = inv.organization_id -- v1.0.1 DO 07022022
AND a.organization_id = inv.organization_id -- v1.0.1 DO 07022022
--UNIDAD
and UOMB.UOM_CODE = inv.PRIMARY_UOM_CODE
and UOMT.UNIT_OF_MEASURE_ID = UOMB.UNIT_OF_MEASURE_ID
AND UOMT.LANGUAGE = 'US'
--SUBINVENTARIO
--AND d.INVENTORY_ITEM_ID = inv.INVENTORY_ITEM_ID 
--AND d.organization_id = inv.organization_id
--AND d.LOCATOR_ID = inv.INVENTORY_LOCATION_ID (+)
--CATEGORIA
/*
AND c.organization_id = inv.organization_id -- v1.0.1 DO 07022022
AND c.INVENTORY_ITEM_ID = inv.INVENTORY_ITEM_ID -- v1.0.1 DO 07022022
AND ECT.CATEGORY_ID = c.CATEGORY_ID
AND ECT.LANGUAGE='US'
*/
--LOTE
AND inv.INVENTORY_ITEM_ID = lot.INVENTORY_ITEM_ID (+)
AND inv.organization_id = lot.organization_id (+)
--SERIE
AND inv.INVENTORY_ITEM_ID = ser.INVENTORY_ITEM_ID (+)
AND inv.organization_id = ser.CURRENT_ORGANIZATION_ID (+)

--AND d.CATEGORY_ID = c.CATEGORY_ID
AND inv.ITEM_NUMBER in ('3503000027','0316000020','0904000012')
--AND inv.ITEM_NUMBER='3503000027'
--AND inv.ITEM_NUMBER='0316000020'
--AND inv.ITEM_NUMBER='0904000012'
AND b.LANGUAGE='US'
),
CATEGORIA AS (
 SELECT art.organization_id, art.INVENTORY_ITEM_ID,c.CATEGORY_ID, ECT.CATEGORY_NAME, ECSB.CATALOG_CODE FROM 
 ARTICULOS art  
 ,egp_item_categories c 
 ,EGP_CATEGORIES_TL ECT
,EGP_CATEGORY_SETS_B ECSB
WHERE 1 = 1
AND art.organization_id = c.organization_id (+)
AND art.INVENTORY_ITEM_ID = c.INVENTORY_ITEM_ID (+)
AND ECT.CATEGORY_ID = c.CATEGORY_ID
AND ECT.LANGUAGE='US'
and c.CATEGORY_SET_ID = ECSB.CATEGORY_SET_ID(+)
GROUP BY art.organization_id, art.INVENTORY_ITEM_ID,c.CATEGORY_ID, ECT.CATEGORY_NAME, ECSB.CATALOG_CODE
),
CANTIDAD AS (
SELECT q.INVENTORY_ITEM_ID,q.ORGANIZATION_ID,loc.SEGMENT1,q.SUBINVENTORY_CODE,Round(sum(q.PRIMARY_TRANSACTION_QUANTITY),3) CANTIDAD 
FROM INV_ONHAND_QUANTITIES_DETAIL q
,ARTICULOS art  
,INV_ITEM_LOCATIONS loc
WHERE 1=1
AND art.organization_id = q.organization_id (+)
AND art.INVENTORY_ITEM_ID = q.INVENTORY_ITEM_ID (+)
AND q.LOCATOR_ID = loc.INVENTORY_LOCATION_ID(+)
AND q.organization_id = loc.organization_id (+)
AND q.SUBINVENTORY_CODE IS NOT NULL
--AND INVENTORY_ITEM_ID = '100000002954640'
--AND organization_id = '300000003087000' 
GROUP BY q.INVENTORY_ITEM_ID,q.ORGANIZATION_ID,loc.SEGMENT1,q.SUBINVENTORY_CODE
)
--SELECT * FROM CATEGORIA
SELECT ART.*
,CA.SUBINVENTORY_CODE
,CA.CANTIDAD
,CA.SEGMENT1
,CAT1.CATEGORY_NAME AS CAT_COMPRAS
,CAT2.CATEGORY_NAME AS CAT_INVENTARIOS
,CAT3.CATEGORY_NAME AS CAT_COSTOS

FROM ARTICULOS ART
,CANTIDAD CA
,CATEGORIA CAT1
,CATEGORIA CAT2
,CATEGORIA CAT3

WHERE 1 = 1
AND CA.ORGANIZATION_ID = ART.ORGANIZATION_ID (+)
AND CA.INVENTORY_ITEM_ID = ART.INVENTORY_ITEM_ID(+)


AND ART.ORGANIZATION_ID = CAT1.ORGANIZATION_ID (+)
AND ART.INVENTORY_ITEM_ID = CAT1.INVENTORY_ITEM_ID (+)
AND CAT1.CATALOG_CODE = 'CAT_COMPRAS'
AND ART.ORGANIZATION_ID = CAT2.ORGANIZATION_ID (+)
AND ART.INVENTORY_ITEM_ID = CAT2.INVENTORY_ITEM_ID (+)
AND CAT2.CATALOG_CODE = 'CAT_INVENTARIOS'
AND ART.ORGANIZATION_ID = CAT3.ORGANIZATION_ID (+)
AND ART.INVENTORY_ITEM_ID = CAT3.INVENTORY_ITEM_ID (+)
AND CAT3.CATALOG_CODE = 'CAT_COSTOS'
